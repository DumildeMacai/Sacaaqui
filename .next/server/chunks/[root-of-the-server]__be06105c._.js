module.exports = {

"[project]/.next-internal/server/app/api/atms/route/actions.js [app-rsc] (server actions loader, ecmascript)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
}}),
"[externals]/next/dist/compiled/next-server/app-route-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-route-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-route-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/@opentelemetry/api [external] (@opentelemetry/api, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("@opentelemetry/api", () => require("@opentelemetry/api"));

module.exports = mod;
}}),
"[externals]/next/dist/compiled/next-server/app-page-turbo.runtime.dev.js [external] (next/dist/compiled/next-server/app-page-turbo.runtime.dev.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js", () => require("next/dist/compiled/next-server/app-page-turbo.runtime.dev.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-unit-async-storage.external.js [external] (next/dist/server/app-render/work-unit-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-unit-async-storage.external.js", () => require("next/dist/server/app-render/work-unit-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/next/dist/server/app-render/work-async-storage.external.js [external] (next/dist/server/app-render/work-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/work-async-storage.external.js", () => require("next/dist/server/app-render/work-async-storage.external.js"));

module.exports = mod;
}}),
"[externals]/firebase-admin [external] (firebase-admin, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("firebase-admin", () => require("firebase-admin"));

module.exports = mod;
}}),
"[externals]/firebase-admin/firestore [external] (firebase-admin/firestore, esm_import)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
const mod = await __turbopack_context__.y("firebase-admin/firestore");

__turbopack_context__.n(mod);
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, true);}),
"[project]/src/firebase/serviceAccountKey.json (json)": ((__turbopack_context__) => {

var { g: global, __dirname } = __turbopack_context__;
{
__turbopack_context__.v(JSON.parse("{\"type\":\"service_account\",\"project_id\":\"atm-locator-nbjla\",\"private_key_id\":\"15099cc97178ce0700aaf89b844e8b2c5f9dc3d6\",\"private_key\":\"-----BEGIN PRIVATE KEY-----\\nMIIEvQIBADANBgkqhkiG9w0BAQEFAASCBKcwggSjAgEAAoIBAQDZb+jCnfpNhnl0\\nAmAdVCWE0n5aAM4U7YEwwRU4S50FtbkiFxu/klfuQrnRWjnMc3KcAA1wum02AFPA\\namGEuNrg6rkBdHOjW/vWv4xEBEsEziD0S+BolyCb3GqaInj+m2eTl6ebFmHpryXi\\nDrOM+kOKMdRHg9O/Upxb+XSVTqHczoDEDFfHxVQk0x3oh8jXRAgenOlYkxVDytLm\\nibHlCyQ3muu3+6oTUMNBJ9RMp0fPDC837wOjxRVLTTqR9lmelSuyzeaZGX8YUrWx\\nSBiz2GCWsX+26LSWslRE2H81grJAi4CVEe6VfvEhgdTjJnRBGkMoRgnANMLtrx1Z\\n54c7mIOnAgMBAAECggEAVtl1Ti8NqGObJXRBcdWHeusc3tRNfFx1asTktey11m8E\\neJJkWfuZNajfUbjJN1mxoJAAzlMYhiZRTZzwQLQZcRcwOF2MRubZy6gM3aodUNkI\\nnqukAgLDWp4K0nAMhh4KnBBKOQ8SouV7qzSWESxxR8Spdrs4G8Zif/Y+09hpnKj+\\nkqehNjCiyiTJFdZIERrknOB2X6eqj93bMuLSVRTXDjHOxcJ+9nelHHNbbO6TTfz\\nSjrMm6EZJuZZG4TdSMGGhZidsjNlm1phKR0VdCoO75FOwCA/o6ewgvyk9D5c5Yxk\\nRhYCxG2hMmpMRt9Imv/xzka+J8s3zFQoanqe0CzwGQKBgQDvyTce4+yJzCrGtNwO\\noiP8LJnPTAGe28W3xlgIE0RjfveFb6v5fNU5NL/upgvRg3z+CcSNdIyXIMyPXysu\\nqfw7XYEw9Iept130cf4+WJP/P5OtCWTf68PuHHby5WCtoNAR0FUrm92vGRAPw6LA\\nddMSVpvnxMUC9dbhZqQHPhmcDQKBgQDoI9O0r2VvvUTKl4Z47r755L2OZY7KiBN8\\nMf491acjc1Q9PSZwVkp2C9C5wVBTV+2UYfKmtN8KiscU5bsXk3fwlhaHH4mDUhxd\\n7kgn0XBCndSKnhy1FyOZK9JqLvKa9NxNt/jjTVbWyinJGgrNcXAAtgqsKZAp06Qf\\nDh43pJUNgwKBgE+WAW2HSOMTmL8LGF7jAf6Y7xQWrhMD7sPoWR+VBYXghlcLkZDl\\nFgA+udWD1zha5AmNRGeO33rpr/uGItcCJG2vw0l0X/K8obqYe0JGNBjsCR/NlmWb\\n4xQM7o4AA+6dCXJgK2Sl/xY2w1X4IPSwJrZXeLecX6dz4TY+0wJ0YhuhAoGBAIHd\\nYRcItE+Ba5WGlSTcMxxrWZvqtqoY3AWzlg6TkrAjWbH0nqdjrr5BN+BjBAPMAc3r\\nyap3LvufzWWkazjyN7vwyuOGwhAkBFiL7/POl+W8k+WENH0eV7zdphXe87u6VfBo\\nhiTq5DS+3gdxuS9bUZQkQu4zRkIP8xWoeUEZooTvAoGAVFWLFnAzSb/W99aN9CWb\\ncMJyACjXil7Bhp9Sw5BU3Xx3KuWWZezn1i9LibKvEynUjKn4BTKiZu8WWF0GU12B\\n7hig0vPuZOtliYintxpwzEQRDyoAxNQBI5RBsILrGgSbjgEna8uCeJ6sEdrwgH1b\\nKviapiW55E5MxUEoxoOmizc=\\n-----END PRIVATE KEY-----\\n\",\"client_email\":\"firebase-adminsdk-fbsvc@atm-locator-nbjla.iam.gserviceaccount.com\",\"client_id\":\"103747057746584546774\",\"auth_uri\":\"https://accounts.google.com/o/oauth2/auth\",\"token_uri\":\"https://oauth2.googleapis.com/token\",\"auth_provider_x509_cert_url\":\"https://www.googleapis.com/oauth2/v1/certs\",\"client_x509_cert_url\":\"https://www.googleapis.com/robot/v1/metadata/x509/firebase-adminsdk-fbsvc%40atm-locator-nbjla.iam.gserviceaccount.com\",\"universe_domain\":\"googleapis.com\"}"));}}),
"[project]/src/lib/firebase-admin.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
// src/lib/firebase-admin.ts
__turbopack_context__.s({
    "addAtm": (()=>addAtm),
    "getAtmById": (()=>getAtmById),
    "getAtms": (()=>getAtms),
    "updateAtm": (()=>updateAtm)
});
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin__$5b$external$5d$__$28$firebase$2d$admin$2c$__cjs$29$__ = __turbopack_context__.i("[externals]/firebase-admin [external] (firebase-admin, cjs)");
var __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__ = __turbopack_context__.i("[externals]/firebase-admin/firestore [external] (firebase-admin/firestore, esm_import)");
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$firebase$2f$serviceAccountKey$2e$json__$28$json$29$__ = __turbopack_context__.i("[project]/src/firebase/serviceAccountKey.json (json)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__
]);
([__TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__);
;
;
;
// Garante que a inicialização ocorra apenas uma vez.
if (!__TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin__$5b$external$5d$__$28$firebase$2d$admin$2c$__cjs$29$__["apps"].length) {
    try {
        (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin__$5b$external$5d$__$28$firebase$2d$admin$2c$__cjs$29$__["initializeApp"])({
            credential: __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin__$5b$external$5d$__$28$firebase$2d$admin$2c$__cjs$29$__["credential"].cert(__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$firebase$2f$serviceAccountKey$2e$json__$28$json$29$__["default"])
        });
        console.log("Firebase Admin SDK inicializado com sucesso a partir do ficheiro de credenciais.");
    } catch (error) {
        console.error("Erro CRÍTICO ao inicializar o Firebase Admin SDK:", error.message);
        throw new Error(`Falha na inicialização do Firebase Admin: ${error.message}`);
    }
}
const db = (0, __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin__$5b$external$5d$__$28$firebase$2d$admin$2c$__cjs$29$__["firestore"])();
async function addAtm(atmData) {
    const newAtmRef = db.collection('atms').doc();
    const newAtm = {
        ...atmData,
        status: 'desconhecido',
        lastUpdate: __TURBOPACK__imported__module__$5b$externals$5d2f$firebase$2d$admin$2f$firestore__$5b$external$5d$__$28$firebase$2d$admin$2f$firestore$2c$__esm_import$29$__["FieldValue"].serverTimestamp(),
        reports: []
    };
    await newAtmRef.set(newAtm);
    return newAtmRef.id;
}
async function updateAtm(id, atmData) {
    const atmRef = db.collection('atms').doc(id);
    // Usamos 'merge: true' para garantir que apenas os campos fornecidos sejam atualizados
    // e para evitar a sobreescrita de 'reports' ou 'status' se não forem incluídos.
    await atmRef.set(atmData, {
        merge: true
    });
}
async function getAtms() {
    try {
        const atmsSnapshot = await db.collection('atms').get();
        if (atmsSnapshot.empty) {
            console.log("Nenhum ATM encontrado no Firestore.");
            return [];
        }
        const atms = atmsSnapshot.docs.map((doc)=>{
            const data = doc.data();
            // Correção: Garante que o timestamp seja convertido para string ISO
            const lastUpdate = data.lastUpdate?.toDate ? data.lastUpdate.toDate().toISOString() : new Date().toISOString();
            const reports = data.reports?.map((report)=>({
                    ...report,
                    // Garante que o timestamp do relatório também seja convertido corretamente.
                    timestamp: report.timestamp?.toDate ? report.timestamp.toDate().toISOString() : report.timestamp || new Date().toISOString()
                })) || [];
            return {
                id: doc.id,
                ...data,
                lastUpdate: lastUpdate,
                reports: reports
            };
        });
        return atms;
    } catch (error) {
        console.error("Erro ao buscar ATMs no Firestore:", error);
        return [];
    }
}
async function getAtmById(id) {
    try {
        const atmDoc = await db.collection('atms').doc(id).get();
        if (!atmDoc.exists) {
            console.log(`ATM com id ${id} não encontrado.`);
            return null;
        }
        const data = atmDoc.data();
        // Correção: Garante que o timestamp seja convertido para string ISO
        const lastUpdate = data.lastUpdate?.toDate ? data.lastUpdate.toDate().toISOString() : new Date().toISOString();
        const reports = data.reports?.map((report)=>({
                ...report,
                // Garante que o timestamp do relatório também seja convertido corretamente.
                timestamp: report.timestamp?.toDate ? report.timestamp.toDate().toISOString() : report.timestamp || new Date().toISOString()
            })) || [];
        return {
            id: atmDoc.id,
            ...data,
            details: data.details || null,
            lastUpdate: lastUpdate,
            reports: reports
        };
    } catch (error) {
        console.error(`Erro ao buscar ATM com id ${id}:`, error);
        return null;
    }
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),
"[externals]/next/dist/server/app-render/after-task-async-storage.external.js [external] (next/dist/server/app-render/after-task-async-storage.external.js, cjs)": (function(__turbopack_context__) {

var { g: global, __dirname, m: module, e: exports } = __turbopack_context__;
{
const mod = __turbopack_context__.x("next/dist/server/app-render/after-task-async-storage.external.js", () => require("next/dist/server/app-render/after-task-async-storage.external.js"));

module.exports = mod;
}}),
"[project]/src/app/api/atms/route.ts [app-route] (ecmascript)": ((__turbopack_context__) => {
"use strict";

var { g: global, __dirname, a: __turbopack_async_module__ } = __turbopack_context__;
__turbopack_async_module__(async (__turbopack_handle_async_dependencies__, __turbopack_async_result__) => { try {
__turbopack_context__.s({
    "GET": (()=>GET),
    "POST": (()=>POST)
});
var __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/src/lib/firebase-admin.ts [app-route] (ecmascript)");
var __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__ = __turbopack_context__.i("[project]/node_modules/next/server.js [app-route] (ecmascript)");
var __turbopack_async_dependencies__ = __turbopack_handle_async_dependencies__([
    __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__
]);
([__TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__] = __turbopack_async_dependencies__.then ? (await __turbopack_async_dependencies__)() : __turbopack_async_dependencies__);
;
;
async function GET() {
    try {
        const atms = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["getAtms"])();
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json(atms);
    } catch (error) {
        console.error('Error fetching ATMs:', error);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal Server Error'
        }, {
            status: 500
        });
    }
}
async function POST(request) {
    try {
        const body = await request.json();
        // Validação robusta dos dados recebidos
        if (!body.name || !body.address || !body.location || typeof body.location.lat !== 'number' || typeof body.location.lng !== 'number') {
            return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
                error: 'Missing or invalid required ATM fields: name, address, location (lat, lng).'
            }, {
                status: 400
            });
        }
        // Cria um payload limpo e bem tipado para garantir a consistência dos dados
        const newAtmPayload = {
            name: body.name,
            address: body.address,
            location: {
                lat: body.location.lat,
                lng: body.location.lng
            },
            details: body.details || ''
        };
        const newAtmId = await (0, __TURBOPACK__imported__module__$5b$project$5d2f$src$2f$lib$2f$firebase$2d$admin$2e$ts__$5b$app$2d$route$5d$__$28$ecmascript$29$__["addAtm"])(newAtmPayload);
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            id: newAtmId,
            message: 'ATM added successfully'
        }, {
            status: 201
        });
    } catch (error) {
        console.error('Error adding ATM:', error);
        const errorMessage = error instanceof Error ? error.message : 'An unknown error occurred';
        return __TURBOPACK__imported__module__$5b$project$5d2f$node_modules$2f$next$2f$server$2e$js__$5b$app$2d$route$5d$__$28$ecmascript$29$__["NextResponse"].json({
            error: 'Internal Server Error',
            details: errorMessage
        }, {
            status: 500
        });
    }
}
__turbopack_async_result__();
} catch(e) { __turbopack_async_result__(e); } }, false);}),

};

//# sourceMappingURL=%5Broot-of-the-server%5D__be06105c._.js.map