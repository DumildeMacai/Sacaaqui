rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Regras para a coleção 'users'
    match /users/{userId} {
      // Qualquer pessoa pode criar um utilizador (para o registo)
      allow create: if true;
      
      // Apenas o próprio utilizador autenticado pode ler ou atualizar os seus próprios dados
      allow read, update: if request.auth != null && request.auth.uid == userId;
    }

    // Regras para a coleção 'atms'
    match /atms/{atmId} {
      // Qualquer utilizador autenticado pode ler a lista de ATMs e os seus detalhes
      allow list, get: if request.auth != null;

      // Qualquer utilizador autenticado pode atualizar um ATM (para reportar status)
      allow update: if request.auth != null;

      // Apenas um administrador pode criar ou apagar um ATM
      function isAdmin() {
        return request.auth != null && request.auth.token.email == 'admin@admin.com';
      }
      allow create, delete: if isAdmin();
    }
  }
}
